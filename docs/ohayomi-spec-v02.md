# おはヨミ 仕様書

**バージョン:** 0.2  
**作成日:** 2026-02-04  
**更新日:** 2026-02-04  
**作成者:** Hasyamo  
**レビュー:** ジュリ

---

## 概要

### アプリ名
**おはヨミ**

### コンセプト
お気に入りのnoteクリエイターの朝活記事を、朝のうちにチェック＆コメントする習慣をつくるPWA

### 背景・課題
- 朝活クリエイターの記事を読みたいが、いつも会社帰りの電車で気づく
- 一日が終わりかけてからでは、朝活の意味が薄れる
- コメント活動も大事にしたいが、漏れがち

---

## 機能一覧

### 1. クリエイター登録機能

| 項目 | 内容 |
|------|------|
| 登録情報 | ID（自動生成）、表示名、noteクリエイターページURL、並び順 |
| 操作 | 追加・編集・削除・並び替え |
| 保存先 | localStorage |

**登録例:**
```json
{
  "id": "c001",
  "name": "ゆめさん",
  "url": "https://note.com/yume_suisho",
  "order": 1
}
```

---

### 2. チェックリスト表示

#### ステータス管理

| 状態 | アイコン | 値 | 意味 |
|------|----------|-----|------|
| 未読 | ⬜ | `unread` | まだ見ていない |
| 読んだ | 👀 | `read` | 記事は読んだ |
| コメント済 | 💬 | `commented` | コメントも書いた |

#### 表示イメージ
```
━━━━━━━━━━━━━━━━━━━━━━
  おはヨミ
  今日の朝活 (2/5 読了, 1/5 コメント)
━━━━━━━━━━━━━━━━━━━━━━

⬜ ゆめさん
💬 むぎさん  
👀 とらねこさん
⬜ 零ぴちゅさん
⬜ あかりさん

━━━━━━━━━━━━━━━━━━━━━━
```

---

### 3. 遷移機能

| 項目 | 内容 |
|------|------|
| タップ動作 | クリエイター名タップでnoteページへ遷移 |
| 遷移先 | `https://note.com/{username}` をブラウザ/アプリで開く |
| 戻り処理 | visibilitychange / focus で復帰検知 → ステータス選択モーダル表示 |

#### 遷移方針
- **基本は `https://note.com/{username}` を開く**
- 端末側でUniversal Links対応していれば、結果としてnoteアプリで開くことがある
- noteアプリのURLスキームは非公開のため、アプリ直起動は仕様化しない

#### 復帰検知の実装
1. クリエイタータップ時に `pendingCreatorId` を sessionStorage へ保存
2. `visibilitychange` または `focus` イベントで復帰を検知
3. `pendingCreatorId` があればステータス選択モーダルを表示

---

### 4. ステータス更新

#### 操作フロー
1. クリエイター名をタップ → noteへ遷移
2. 記事を読む（/コメントする）
3. おはヨミに戻る（復帰検知）
4. モーダルで「読んだ」or「コメントした」を選択
5. リストに反映

#### モーダルUI
```
┌─────────────────────┐
│  ゆめさん           │
│                     │
│  [👀 読んだ]        │
│  [💬 コメントした]  │
│  [キャンセル]       │
└─────────────────────┘
```

---

### 5. 日次リセット

| 項目 | 内容 |
|------|------|
| リセット基準時刻 | AM 5:00（JST） |
| トリガー | アプリ起動時 / フォーカス復帰時 |
| 判定ロジック | `lastResetAt` が直近のAM5:00より古ければリセット実行 |
| 手動リセット | リセットボタンで即時リセット |
| リセット対象 | ステータスのみ（登録情報は維持） |

#### 実装方針
- **日次リセットはバックグラウンド実行ではなく、起動/復帰時に5:00跨ぎを検知して適用する**
- iOS PWAはバックグラウンド定時処理ができないため、この方式が現実解

#### 判定ロジック（疑似コード）
```javascript
const now = new Date();
const today5am = new Date(now);
today5am.setHours(5, 0, 0, 0);

// 現在時刻が5時前なら、基準は昨日の5時
if (now < today5am) {
  today5am.setDate(today5am.getDate() - 1);
}

if (!lastResetAt || new Date(lastResetAt) < today5am) {
  resetAllStatus();
  lastResetAt = now.toISOString();
}
```

---

## データモデル

### localStorage構造

```javascript
// クリエイター一覧
"ohayomi_creators": [
  { "id": "c001", "name": "ゆめさん", "url": "https://note.com/yume_suisho", "order": 1 },
  { "id": "c002", "name": "むぎさん", "url": "https://note.com/mugi_xxx", "order": 2 }
]

// 日次ステータス
"ohayomi_dailyStatus": {
  "dateKey": "2026-02-04",
  "items": {
    "c001": { "status": "unread", "updatedAt": null },
    "c002": { "status": "commented", "updatedAt": "2026-02-04T07:30:00+09:00" }
  }
}

// リセット管理
"ohayomi_lastResetAt": "2026-02-04T05:00:00+09:00"

// 連続記録（追加機能）
"ohayomi_streak": {
  "current": 5,
  "best": 12,
  "lastCompleteDate": "2026-02-03"
}
```

### sessionStorage構造

```javascript
// 遷移中のクリエイターID
"ohayomi_pendingCreatorId": "c001"
```

---

## 画面構成

### 1画面SPA + モーダル切替

| 要素 | 種別 | 内容 |
|------|------|------|
| メイン画面 | 常時表示 | チェックリスト、進捗表示 |
| 登録モーダル | オーバーレイ | クリエイター追加・編集 |
| 設定モーダル | オーバーレイ | リセット時刻設定など |
| ステータスモーダル | オーバーレイ | 読んだ/コメントした選択 |
| 削除確認モーダル | オーバーレイ | 削除前の確認 |

---

## 追加機能（あると嬉しい）

### 進捗表示
- 読了数 / 全体数
- コメント数 / 全体数

### 連続記録
- 連続チェック日数のカウント
- 全員チェック完了した日をカウント
- 最高記録の保持

### 履歴（将来拡張）
- クリエイターごとの最終チェック日時
- 過去7日間のチェック履歴
- データ量増加時は IndexedDB へ移行検討

---

## 後回し機能

| 機能 | 理由 |
|------|------|
| プッシュ通知 | サーバー必要 |
| RSS新着判定 | 外部API/スクレイピング必要 |
| 複数リスト管理 | まずは単一リストで運用 |
| クラウド同期 | ローカルのみで開始 |

---

## 技術仕様

### アーキテクチャ
- **種別:** PWA（Progressive Web App）
- **フレームワーク:** React + Vite
- **データ保存:** localStorage（将来的にIndexedDB検討）
- **ホスティング:** GitHub Pages（予定）

### 対応環境
- iOS Safari（メイン）
- Android Chrome
- デスクトップブラウザ

### PWA要件
- ホーム画面に追加可能
- オフライン対応（登録データ表示）
- レスポンシブデザイン

---

## 開発スケジュール（案）

| フェーズ | 内容 | 期間 |
|----------|------|------|
| Phase 1 | 基本機能（登録・表示・遷移・ステータス管理・モーダル） | 1日 |
| Phase 2 | 日次リセット（起動時判定）・進捗表示 | 半日 |
| Phase 3 | PWA化・ホーム画面追加対応 | 半日 |
| Phase 4 | 運用テスト・調整 | 随時 |

---

## 記事ネタ案

- 「朝活クリエイターを見逃さないためにPWA作った話」
- 「コメント活動を習慣化するアプリを作ってみた」
- 「おはカノ開発者が作った、もう一つの朝習慣アプリ」
- 「PWAでできること・できないこと：日次リセットの落とし穴」

---

## 備考

- おはようカノジョ（おはカノ）との統一感を意識
- まずは自分用として運用し、改善点を洗い出す
- noteフォロワー推移PWAの経験を活かす
- noteアプリのURLスキームは非公開のため、遷移は原則httpsを使用し、アプリ起動は端末側挙動に委ねる
