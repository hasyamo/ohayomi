# おはヨミ 仕様書

**バージョン:** 0.3  
**作成日:** 2026-02-04  
**更新日:** 2026-02-06  
**作成者:** Hasyamo  
**レビュー:** ジュリ

---

## 概要

### アプリ名
**おはヨミ**

### コンセプト
お気に入りのnoteクリエイターの朝活記事を、朝のうちにチェック＆コメントする習慣をつくるPWA

### 背景・課題
- 朝活クリエイターの記事を読みたいが、いつも会社帰りの電車で気づく
- 一日が終わりかけてからでは、朝活の意味が薄れる
- コメント活動も大事にしたいが、漏れがち

---

## 機能一覧

### 1. クリエイター登録機能

#### 簡単登録（URL貼り付け）

| 項目 | 内容 |
|------|------|
| 入力 | noteの任意の記事URL |
| 抽出 | URLからユーザー名を自動抽出 |
| 生成 | クリエイターページURLを自動生成 |

**URL解析ロジック:**
```javascript
// 入力例: https://note.com/hasyamo/n/nc14373cd72ca
// 正規表現: note\.com/([^/]+)
// 抽出結果: hasyamo
// 生成URL: https://note.com/hasyamo

const match = inputUrl.match(/note\.com\/([^\/]+)/);
if (match) {
  const username = match[1];
  const creatorUrl = `https://note.com/${username}`;
}
```

**対応URLパターン:**
- `https://note.com/{username}` （クリエイターページ）
- `https://note.com/{username}/n/{noteId}` （記事ページ）
- `https://note.com/{username}/m/{magazineId}` （マガジンページ）

#### 登録データ

| 項目 | 内容 | 自動/手動 |
|------|------|-----------|
| id | 一意のID（自動生成） | 自動 |
| username | noteユーザー名 | 自動（URL抽出） |
| name | 表示名 | 自動（初期値=username）→ 手動編集可 |
| url | クリエイターページURL | 自動 |
| iconUrl | アイコン画像URL | 自動（API取得） |
| order | 並び順 | 手動 |
| archived | アーカイブ状態 | 手動 |
| lastKnownArticleCount | 最後に確認した記事数 | 自動（API取得） |
| lastCheckedAt | 最終チェック日時 | 自動 |

---

### 2. アーカイブ機能

削除機能は実装せず、アーカイブ（非表示）で対応する。

| 状態 | archived | 表示 |
|------|----------|------|
| アクティブ | `false` | メイン一覧に表示 |
| アーカイブ | `true` | メイン一覧から非表示、設定画面で管理 |

**操作:**
- アーカイブする: クリエイターを長押し or メニューから「アーカイブ」
- 復帰する: 設定画面のアーカイブ一覧から「復帰」

**ユースケース:**
- 読まなくなったクリエイターを一時的に隠す
- 気が変わったら復帰できる
- データは残るので履歴も保持

---

### 3. チェックリスト表示

#### ステータス管理

| 状態 | アイコン | 値 | 意味 |
|------|----------|-----|------|
| 未読 | ⬜ | `unread` | まだ見ていない |
| 読んだ | 👀 | `read` | 記事は読んだ |
| コメント済 | 💬 | `commented` | コメントも書いた |

#### クリエイターアイコン表示

- 積み上げノートのAPIプロキシを流用してアイコンURLを取得
- 一覧でアイコン + 表示名で視認性向上

#### 新着判定

| 項目 | 内容 |
|------|------|
| 保存 | `lastKnownArticleCount` に記事数を記録 |
| 取得 | APIプロキシ経由でクリエイターページから記事数取得 |
| 判定 | 現在の記事数 > 保存値 なら新着あり |
| 表示 | 🆕 バッジで表示 |
| 更新 | チェック後に `lastKnownArticleCount` を更新 |

#### 表示イメージ
```
━━━━━━━━━━━━━━━━━━━━━━
  おはヨミ
  今日の朝活 (2/5 読了, 1/5 コメント)
━━━━━━━━━━━━━━━━━━━━━━

[👤] ⬜ ゆめさん 🆕
[👤] 💬 むぎさん  
[👤] 👀 とらねこさん
[👤] ⬜ 零ぴちゅさん 🆕
[👤] ⬜ あかりさん

━━━━━━━━━━━━━━━━━━━━━━
```

---

### 4. 遷移機能

| 項目 | 内容 |
|------|------|
| タップ動作 | クリエイター名タップでnoteページへ遷移 |
| 遷移先 | `https://note.com/{username}` をブラウザ/アプリで開く |
| 戻り処理 | visibilitychange / focus で復帰検知 → ステータス選択モーダル表示 |

#### 遷移方針
- **基本は `https://note.com/{username}` を開く**
- 端末側でUniversal Links対応していれば、結果としてnoteアプリで開くことがある
- noteアプリのURLスキームは非公開のため、アプリ直起動は仕様化しない

#### 復帰検知の実装
1. クリエイタータップ時に `pendingCreatorId` を sessionStorage へ保存
2. `visibilitychange` または `focus` イベントで復帰を検知
3. `pendingCreatorId` があればステータス選択モーダルを表示

---

### 5. ステータス更新

#### 操作フロー
1. クリエイター名をタップ → noteへ遷移
2. 記事を読む（/コメントする）
3. おはヨミに戻る（復帰検知）
4. モーダルで「読んだ」or「コメントした」を選択
5. リストに反映
6. `lastKnownArticleCount` を更新（新着バッジ消去）

#### モーダルUI
```
┌─────────────────────┐
│  [👤] ゆめさん      │
│                     │
│  [👀 読んだ]        │
│  [💬 コメントした]  │
│  [キャンセル]       │
└─────────────────────┘
```

---

### 6. 日次リセット

| 項目 | 内容 |
|------|------|
| リセット基準時刻 | AM 5:00（JST） |
| トリガー | アプリ起動時 / フォーカス復帰時 |
| 判定ロジック | `lastResetAt` が直近のAM5:00より古ければリセット実行 |
| 手動リセット | リセットボタンで即時リセット |
| リセット対象 | ステータスのみ（登録情報・記事数は維持） |

#### 実装方針
- **日次リセットはバックグラウンド実行ではなく、起動/復帰時に5:00跨ぎを検知して適用する**
- iOS PWAはバックグラウンド定時処理ができないため、この方式が現実解

#### 判定ロジック（疑似コード）
```javascript
const now = new Date();
const today5am = new Date(now);
today5am.setHours(5, 0, 0, 0);

// 現在時刻が5時前なら、基準は昨日の5時
if (now < today5am) {
  today5am.setDate(today5am.getDate() - 1);
}

if (!lastResetAt || new Date(lastResetAt) < today5am) {
  resetAllStatus();
  lastResetAt = now.toISOString();
}
```

---

## データモデル

### localStorage構造

```javascript
// クリエイター一覧
"ohayomi_creators": [
  {
    "id": "c001",
    "username": "yume_suisho",
    "name": "ゆめさん",
    "url": "https://note.com/yume_suisho",
    "iconUrl": "https://assets.st-note.com/...",
    "order": 1,
    "archived": false,
    "lastKnownArticleCount": 142,
    "lastCheckedAt": "2026-02-04T07:30:00+09:00"
  },
  {
    "id": "c002",
    "username": "mugi_xxx",
    "name": "むぎさん",
    "url": "https://note.com/mugi_xxx",
    "iconUrl": "https://assets.st-note.com/...",
    "order": 2,
    "archived": false,
    "lastKnownArticleCount": 85,
    "lastCheckedAt": "2026-02-04T07:35:00+09:00"
  }
]

// 日次ステータス
"ohayomi_dailyStatus": {
  "dateKey": "2026-02-04",
  "items": {
    "c001": { "status": "unread", "updatedAt": null },
    "c002": { "status": "commented", "updatedAt": "2026-02-04T07:30:00+09:00" }
  }
}

// リセット管理
"ohayomi_lastResetAt": "2026-02-04T05:00:00+09:00"

// 連続記録（追加機能）
"ohayomi_streak": {
  "current": 5,
  "best": 12,
  "lastCompleteDate": "2026-02-03"
}
```

### sessionStorage構造

```javascript
// 遷移中のクリエイターID
"ohayomi_pendingCreatorId": "c001"
```

---

## 外部API連携

### 積み上げノートAPIプロキシ

| 取得項目 | 用途 |
|----------|------|
| アイコンURL | 一覧表示 |
| 記事数 | 新着判定 |

**取得タイミング:**
- クリエイター登録時
- アプリ起動時（バックグラウンドで更新）
- 手動リフレッシュ時

**エラーハンドリング:**
- API取得失敗時はキャッシュを使用
- アイコン取得失敗時はデフォルトアイコン表示

---

## 画面構成

### 1画面SPA + モーダル切替

| 要素 | 種別 | 内容 |
|------|------|------|
| メイン画面 | 常時表示 | チェックリスト、進捗表示 |
| 登録モーダル | オーバーレイ | URL貼り付け → 自動解析 → 表示名編集 |
| 設定モーダル | オーバーレイ | リセット、アーカイブ管理 |
| ステータスモーダル | オーバーレイ | 読んだ/コメントした選択 |
| クリエイター編集モーダル | オーバーレイ | 表示名編集、アーカイブ |

---

## 追加機能（あると嬉しい）

### 進捗表示
- 読了数 / 全体数
- コメント数 / 全体数

### 連続記録
- 連続チェック日数のカウント
- 全員チェック完了した日をカウント
- 最高記録の保持

### 履歴（将来拡張）
- クリエイターごとの最終チェック日時
- 過去7日間のチェック履歴
- データ量増加時は IndexedDB へ移行検討

---

## 後回し機能

| 機能 | 理由 |
|------|------|
| プッシュ通知 | サーバー必要 |
| RSS新着判定 | 記事数ベースで代替 |
| 複数リスト管理 | まずは単一リストで運用 |
| クラウド同期 | ローカルのみで開始 |

---

## 技術仕様

### アーキテクチャ
- **種別:** PWA（Progressive Web App）
- **フレームワーク:** React + Vite
- **データ保存:** localStorage（将来的にIndexedDB検討）
- **外部API:** 積み上げノートAPIプロキシ
- **ホスティング:** GitHub Pages（予定）

### 対応環境
- iOS Safari（メイン）
- Android Chrome
- デスクトップブラウザ

### PWA要件
- ホーム画面に追加可能
- オフライン対応（登録データ表示）
- レスポンシブデザイン

---

## 開発スケジュール（案）

| フェーズ | 内容 | 期間 |
|----------|------|------|
| Phase 1 | 基本機能（URL登録・表示・遷移・ステータス管理・モーダル） | 1日 |
| Phase 2 | 日次リセット（起動時判定）・進捗表示 | 半日 |
| Phase 3 | APIプロキシ連携（アイコン・新着判定） | 半日 |
| Phase 4 | PWA化・ホーム画面追加対応 | 半日 |
| Phase 5 | 運用テスト・調整 | 随時 |

---

## 記事ネタ案

- 「朝活クリエイターを見逃さないためにPWA作った話」
- 「コメント活動を習慣化するアプリを作ってみた」
- 「おはカノ開発者が作った、もう一つの朝習慣アプリ」
- 「PWAでできること・できないこと：日次リセットの落とし穴」
- 「noteのURLからユーザー名を抽出する正規表現」

---

## 備考

- おはようカノジョ（おはカノ）との統一感を意識
- まずは自分用として運用し、改善点を洗い出す
- noteフォロワー推移PWA・積み上げノートの経験を活かす
- noteアプリのURLスキームは非公開のため、遷移は原則httpsを使用し、アプリ起動は端末側挙動に委ねる
